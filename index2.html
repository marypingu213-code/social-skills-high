<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç·’æ‹†å½ˆä¸»æ§å° (TVç«¯) - QR Code ç‰ˆ</title>
    <style>
        /* --- æ—¢æœ‰æ¨£å¼ä¿æŒä¸è®Š --- */
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            text-align: center;
            width: 90%;
            max-width: 1200px;
            position: relative;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 3px solid #ff3333;
            padding-bottom: 10px;
        }

        h1 {
            color: #ff3333;
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 10px #ff0000;
        }

        #timer {
            font-family: 'Courier New', monospace;
            font-size: 3.5em;
            color: #ff0000;
            font-weight: bold;
        }

        #question-box {
            background-color: #222;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #555;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
            min-height: 500px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #situation-text {
            font-size: 2em;
            line-height: 1.3;
            margin-bottom: 25px;
            color: #ffff00;
            font-weight: bold;
            width: 100%;
        }

        .options-list {
            list-style: none;
            padding: 0;
            text-align: left;
            display: inline-block;
        }

        .options-list li {
            font-size: 1.6em;
            margin-bottom: 20px;
            padding: 12px 20px;
            background-color: #333;
            border-radius: 10px;
            border-left: 8px solid #555;
        }
        
        .option-label {
            font-weight: bold;
            color: #00ffff;
            margin-right: 15px;
        }

        /* --- è¤‡ç¿’é é¢åœ–å¡ç¶²æ ¼æ¨£å¼ --- */
        .review-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4æ¬„ */
            gap: 15px;
            width: 100%;
            margin-top: 10px;
        }
        .review-img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid #444;
            box-shadow: 0 0 10px rgba(0,255,255,0.1);
            transition: transform 0.2s;
            cursor: pointer;
        }
        .review-img:hover {
             transform: scale(1.05);
             border-color: #00ffff;
        }

        /* --- å‹•ç•«èˆ‡é®ç½©æ¨£å¼ --- */
        
        /* 1. æˆåŠŸ/ç­”å°é®ç½© */
        #success-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.92);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            animation: fadeIn 0.3s;
        }
        
        #success-image {
            max-width: 90%;
            max-height: 80vh; 
            border: 8px solid #FFD700;
            border-radius: 20px;
            box-shadow: 0 0 60px #FFD700;
            object-fit: contain;
        }

        #success-title {
             color: #FFD700;
             font-size: 3em;
             margin-bottom: 20px;
             text-shadow: 0 0 20px #FFD700;
        }
        
        #close-hint {
            color: #aaa;
            margin-top: 20px;
            font-size: 1.2em;
            animation: pulse 2s infinite;
        }

        /* 2. è¤‡ç¿’åœ–å¡æ”¾å¤§é®ç½© */
        #zoom-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            cursor: pointer;
            animation: fadeIn 0.2s;
        }

        #zoomed-review-image {
            max-width: 95%;
            max-height: 95vh;
            border: 4px solid #00ffff;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            object-fit: contain;
            cursor: default;
        }

        /* 3. å¤±æ•—/ç­”éŒ¯é®ç½© */
        #fail-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 0, 0, 0.8);
            display: none;
            align-items: center; justify-content: center;
            z-index: 100;
            animation: flashRed 0.5s infinite;
        }

        /* --- æ–°å¢ï¼šQR Code é®ç½©æ¨£å¼ --- */
        #qr-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: none; /* é è¨­éš±è— */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 300; /* æœ€é«˜å±¤ç´š */
            animation: fadeIn 0.3s;
        }

        #qr-box {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        #qr-image {
            width: 400px;
            height: 400px;
            background-color: #ddd; /* è¼‰å…¥å‰çš„ä½”ä½é¡è‰² */
        }

        /* å‹•ç•«å®šç¾© */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes flashRed { 0%,100% {background-color: rgba(255,0,0,0.8);} 50% {background-color: rgba(255,0,0,0.4);} }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <div id="game-container">
        <header>
            <h1>âš¡ æƒ…ç·’æ‹†å½ˆä¸»æ§å° âš¡</h1>
            <div id="timer">--:--</div>
        </header>

        <div id="question-box">
            <div id="situation-text"></div>
            <ul class="options-list" id="options-list"></ul>
        </div>
    </div>

    <div id="success-overlay">
        <h2 id="success-title">âœ… æ‹†å½ˆæˆåŠŸï¼æ­£ç¢ºç§˜è¨£æ˜¯ï¼š</h2>
        <img id="success-image" src="" alt="æˆåŠŸç§˜è¨£åœ–å¡">
        <p id="close-hint">æŒ‰éµç›¤ [Esc] é—œé–‰è¦–çª—</p>
    </div>

    <div id="zoom-overlay" onclick="closeZoom()">
        <img id="zoomed-review-image" src="" alt="æ”¾å¤§åœ–å¡" onclick="event.stopPropagation()">
        <p style="margin-top:15px; color:#aaa; font-size:1.2em;">(é»æ“ŠèƒŒæ™¯æˆ–æŒ‰ Esc é—œé–‰)</p>
    </div>

    <div id="fail-overlay">
        <h2>âŒ éŒ¯èª¤è­¦å‘Šï¼ âŒ</h2>
    </div>

    <div id="qr-overlay" onclick="closeQR()">
        <div id="qr-box" onclick="event.stopPropagation()">
            <h2 style="color:black; margin-top:0; margin-bottom: 20px;">ğŸ“± å­¸ç”Ÿå¹³æ¿è«‹æƒææ­¤è™•</h2>
            <img id="qr-image" src="" alt="ç”Ÿæˆä¸­...">
            <p style="color:#555; margin-bottom:0; margin-top: 10px; font-weight: bold;">æƒæå¾Œå°‡é€²å…¥æ§åˆ¶å™¨é é¢</p>
        </div>
        <p style="margin-top:20px; color:#aaa; font-size:1.2em;">(é»æ“ŠèƒŒæ™¯é—œé–‰)</p>
    </div>

    <script>
        // --- è¤‡ç¿’åœ–å¡æª”å ---
        const reviewImages = [
            "images/image_5.png",
            "images/jealousy.png",
            "images/content.png",
            "images/fear.png",
            "images/shyness.png",
            "images/disappointment.png",
            "images/cherish.png",
            "images/suspect.png"
        ];

        // --- é¡Œåº«è³‡æ–™ ---
        const questions = [
            {
                situation: "ã€ç‹€æ³ä¸€ï¼šæ€’ç«ä¸­ç‡’ã€‘<br>é«”è‚²èª²åˆ†çµ„ï¼Œå°è¯ä¸æƒ³è·Ÿä½ ä¸€çµ„ï¼Œé‚„å¤§è²èªªï¼šã€Œä½ è·‘å¤ªæ…¢äº†ï¼Œæœƒå®³æˆ‘å€‘è¼¸ï¼ã€ä½ è½åˆ°å¾Œè¦ºå¾—è‡‰å¥½ç†±ï¼Œæ‹³é ­éƒ½ç¡¬äº†ã€‚",
                options: ["A. å¤§è²å¼å›å»ï¼šã€Œä½ æ‰æ…¢ï¼ä½ å…¨å®¶éƒ½æ…¢ï¼ã€", "B. å…ˆå¾®ç¬‘ï¼Œä¸è¦å‹•ä¸å‹•å°±ç”Ÿæ°£ï¼Œç„¶å¾Œè¼•è²èªªè©±ã€‚", "C. ç”¨åŠ›æ¨ä»–ä¸€ä¸‹ï¼Œè®“ä»–çŸ¥é“ä½ ä¸å¥½æƒ¹ã€‚"],
                image: "images/image_5.png" 
            },
            {
                situation: "ã€ç‹€æ³äºŒï¼šé…¸è‘¡è„å¿ƒç†ã€‘<br>ç¹ªç•«æ¯”è³½çµæœå…¬ä½ˆäº†ï¼Œä½ è¦ºå¾—è‡ªå·±ç•«å¾—æœ€å¥½ï¼Œä½†éš”å£ç­çš„å°ç¾å¾—äº†ç¬¬ä¸€åã€‚å¤§å®¶éƒ½åœ¨æ­å–œå¥¹ï¼Œä½ å¿ƒè£¡è¦ºå¾—é…¸é…¸åˆºåˆºçš„ã€‚",
                options: ["A. è·ŸåŒå­¸èªªï¼šã€Œå¥¹ä¸€å®šæ˜¯ä½œå¼Šçš„å•¦ï¼ã€", "B. ç‚ºåˆ¥äººçš„æˆåŠŸå–é‡‡ï¼Œæ‹æ‰‹è·Ÿå¥¹èªªæ­å–œã€‚", "C. å‡è£æ²’çœ‹åˆ°ï¼Œè½‰é ­å°±èµ°ã€‚"],
                image: "images/jealousy.png"
            },
            {
                situation: "ã€ç‹€æ³ä¸‰ï¼šä¸çŸ¥æ»¿è¶³ã€‘<br>å…’ç«¥ç¯€å­¸æ ¡ç™¼ç¦®ç‰©ï¼Œå¾—åˆ°ä¸€ç›’å½©è‰²ç­†ã€‚ä½ å¾ˆå¤±æœ›ï¼Œå› ç‚ºä½ æ¯”è¼ƒæƒ³è¦éš”å£ç­ç™¼çš„é™æ§æ±½è»Šã€‚ä½ è¦ºå¾—é€™ç¦®ç‰©çˆ›é€äº†ã€‚",
                options: ["A. æŠŠå½©è‰²ç­†ä¸Ÿåœ¨æ¡Œä¸Šèªªï¼šã€Œæˆ‘æ‰ä¸æƒ³è¦é€™å€‹ï¼ã€", "B. ç”¨å¿ƒæ„Ÿå—ï¼ŒçŸ¥é“æ“æœ‰å¾ˆå¤šæ±è¥¿ä¸ä»£è¡¨å¹¸ç¦ï¼Œè¦æ‡‚å¾—çŸ¥è¶³ã€‚", "C. å»è·Ÿè€å¸«åµè‘—è¦æ›ç¦®ç‰©ã€‚"],
                image: "images/content.png"
            },
            {
                situation: "ã€ç‹€æ³å››ï¼šèˆå°ææ‡¼ã€‘<br>è¼ªåˆ°ä½ ä¸Šå°è®€æ›¸å¿ƒå¾—äº†ã€‚çœ‹è‘—å°ä¸‹å¥½å¤šçœ¼ç›ç›¯è‘—ä½ ï¼Œå¿ƒè‡Ÿå¿«è·³å‡ºä¾†ï¼Œè…¦è¢‹ä¸€ç‰‡ç©ºç™½ï¼Œå¥½æƒ³é€ƒè·‘ï¼",
                options: ["A. å†·éœä¸€é»ï¼åƒè¬åˆ¥æ…Œå¼µï¼å¿ƒå¹³æ°£å’Œå°±èƒ½æƒ³å‡ºè¾¦æ³•ã€‚", "B. å‡è£è‚šå­ç—›ï¼Œè·‘å»å»æ‰€èº²èµ·ä¾†ã€‚", "C. ä½è‘—é ­å¿«é€Ÿéš¨ä¾¿å”¸ä¸€å”¸è¶•å¿«ä¸‹å°ã€‚"],
                image: "images/fear.png"
            },
            {
                situation: "ã€ç‹€æ³äº”ï¼šç¤¾äº¤ç„¦æ…®ã€‘<br>æ–°å­¸æœŸè¦åœ¨å…¨ç­é¢å‰è‡ªæˆ‘ä»‹ç´¹ã€‚ä½ è¦ºå¾—å¾ˆå°·å°¬ã€è†½æ€¯ï¼Œæ€•å¤§å®¶æœƒç¬‘ä½ ï¼Œä¸€å¥è©±éƒ½èªªä¸å‡ºä¾†ã€‚",
                options: ["A. è¦ºå¾—å¤§å®¶ä¸€å®šéƒ½åœ¨å¿ƒè£¡å˜²ç¬‘æˆ‘ã€‚", "B. æ‹’çµ•ä¸Šå°ï¼Œè¶´åœ¨æ¡Œå­ä¸Šã€‚", "C. ä»”ç´°æƒ³ï¼Œä»–å€‘ä¸€å®šä¹Ÿæœ‰å®³ç¾çš„æ™‚å€™ï¼Œå°±å’Œæˆ‘ä¸€æ¨£ã€‚"],
                image: "images/shyness.png"
            },
             {
                situation: "ğŸ‰ æ­å–œï¼æ‰€æœ‰ä»»å‹™æŒ‘æˆ°å®Œæˆï¼ ğŸ‰<br>ä½ å€‘æ˜¯æœ€æ£’çš„æƒ…ç·’æ‹†å½ˆå°ˆå®¶ï¼",
                options: [],
                image: ""
            }
        ];

        // è®Šæ•¸å®šç¾©
        let currentQuestionIndex = -1; 
        const situationText = document.getElementById('situation-text');
        const optionsList = document.getElementById('options-list');
        const timerDisplay = document.getElementById('timer');
        const successOverlay = document.getElementById('success-overlay');
        const successImage = document.getElementById('success-image');
        const failOverlay = document.getElementById('fail-overlay');
        const zoomOverlay = document.getElementById('zoom-overlay');
        const zoomedReviewImage = document.getElementById('zoomed-review-image');
        // æ–°å¢ QR ç›¸é—œè®Šæ•¸
        const qrOverlay = document.getElementById('qr-overlay');
        const qrImage = document.getElementById('qr-image');
        
        let timerInterval;

        // --- åŠŸèƒ½å‡½æ•¸ ---
        function zoomImage(src) {
            zoomedReviewImage.src = src;
            zoomOverlay.style.display = 'flex';
        }

        function closeZoom() {
            zoomOverlay.style.display = 'none';
        }
        
        // æ–°å¢ï¼šé¡¯ç¤º/é—œé–‰ QR Code
        function showQR() {
            // è‡ªå‹•è¨ˆç®—å­¸ç”Ÿç«¯ tablet.html çš„å®Œæ•´ç¶²å€
            const currentURL = window.location.href;
            // ç§»é™¤ç¶²å€æœ€å¾Œçš„ tv.html (å¦‚æœæœ‰çš„è©±) ä»¥åŠå¯èƒ½çš„åƒæ•¸ï¼Œåªä¿ç•™è·¯å¾‘
            const baseUrl = currentURL.substring(0, currentURL.lastIndexOf('/') + 1);
            const studentURL = baseUrl + 'tablet.html';
            
            // ä½¿ç”¨å…è²» API ç”¢ç”Ÿ QR Code
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(studentURL)}`;
            
            qrImage.src = qrApiUrl;
            qrOverlay.style.display = 'flex';
        }

        function closeQR() {
            qrOverlay.style.display = 'none';
        }


        // é¡¯ç¤ºé é¢çš„æ ¸å¿ƒå‡½æ•¸
        function showPage(index) {
            clearInterval(timerInterval); 
            timerDisplay.textContent = "--:--";
            timerDisplay.style.color = "#ff0000";
            optionsList.innerHTML = ""; 

            if (index === -1) {
                // --- é¡¯ç¤ºé¦–é  (ç‚¸å½ˆåœ– + QR æŒ‰éˆ•) ---
                situationText.innerHTML = `
                    <img src="images/bomb.png" alt="æ‹†å½ˆä»»å‹™" style="max-width: 500px; height: auto; display: block; margin: 0 auto 20px auto; border-radius: 20px; box-shadow: 0 0 40px rgba(255,50,50,0.5);">
                    <div style="font-size: 1.2em;">æº–å‚™å¥½äº†å—ï¼Ÿç‰¹æ”»éšŠé›†åˆï¼</div>
                    
                    <button onclick="showQR()" style="margin-top: 25px; padding: 15px 40px; font-size: 1.3em; background-color: #00ffff; color: #000; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 0 25px rgba(0,255,255,0.6); transition: transform 0.1s;">
                        ğŸ“± é¡¯ç¤ºå­¸ç”Ÿç™»å…¥ QR Code
                    </button>

                    <div style="font-size: 0.6em; color: #aaa; margin-top: 30px;">(å…¨å“¡é€£ç·šå¾Œï¼ŒæŒ‰éµç›¤ [â†’] é€²å…¥è¤‡ç¿’)</div>
                `;
            } 
            else if (index === 0) {
                // --- é¡¯ç¤ºè¤‡ç¿’é é¢ ---
                let gridHtml = '<div class="review-grid">';
                reviewImages.forEach(imgSrc => {
                    gridHtml += `<img src="${imgSrc}" class="review-img" alt="ç§˜è¨£åœ–å¡" onclick="zoomImage('${imgSrc}')">`;
                });
                gridHtml += '</div>';

                situationText.innerHTML = `
                    <div style="font-size: 1em; color: #00ffff; margin-bottom:15px;">ã€ä»»å‹™å‰å°è¦½ã€‘è«‹å¿«é€Ÿè¤‡ç¿’é€™ 8 å€‹æƒ…ç·’å°ç§˜è¨£ï¼(é»æ“Šåœ–ç‰‡å¯æ”¾å¤§)</div>
                    ${gridHtml}
                    <div style="font-size: 0.6em; color: #aaa; margin-top: 20px;">(æŒ‰éµç›¤ [â†’] é–‹å§‹ç¬¬ä¸€é¡Œï¼Œè¨ˆæ™‚å°‡å•Ÿå‹•ï¼)</div>
                `;
            } 
            else if (index > 0 && index <= questions.length) {
                // --- é¡¯ç¤ºé¡Œç›®é é¢ ---
                const qIndex = index - 1; 
                const q = questions[qIndex];
                situationText.innerHTML = q.situation;
                
                q.options.forEach(opt => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="option-label">${opt.substring(0, 2)}</span>${opt.substring(2)}`;
                    optionsList.appendChild(li);
                });

                if (qIndex < questions.length - 1) {
                    startTimer(60);
                }
            }
            currentQuestionIndex = index;
        }

        function startTimer(seconds) {
            let timeLeft = seconds;
            updateTimerDisplay(timeLeft);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.style.color = "#555"; 
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${mins}:${secs}`;
            if (seconds > 0 && seconds <= 10) timerDisplay.style.color = "red";
        }

        // --- éµç›¤æ§åˆ¶æ ¸å¿ƒé‚è¼¯ ---
        document.addEventListener('keydown', (e) => {
            // è™•ç† [Esc] éµï¼šå„ªå…ˆé—œé–‰ä»»ä½•æ‰“é–‹çš„é®ç½©
            if (e.code === 'Escape') {
                if (qrOverlay.style.display === 'flex') { closeQR(); return; }
                if (successOverlay.style.display === 'flex') { successOverlay.style.display = 'none'; return; }
                if (zoomOverlay.style.display === 'flex') { closeZoom(); return; }
                return;
            }

            // å¦‚æœä»»ä½•é®ç½©é–‹è‘—ï¼Œé–å®šå…¶ä»–æŒ‰éµ
            if (successOverlay.style.display === 'flex' || zoomOverlay.style.display === 'flex' || qrOverlay.style.display === 'flex') return;

            const totalPages = questions.length;

            if (e.code === 'ArrowRight') {
                if (currentQuestionIndex < totalPages) {
                    showPage(currentQuestionIndex + 1);
                }
            } else if (e.code === 'ArrowLeft') {
                if (currentQuestionIndex > -1) {
                    showPage(currentQuestionIndex - 1);
                }
            } else if (e.code === 'Space') {
                // --- [ç©ºç™½éµ] é¡¯ç¤ºæˆåŠŸåœ–å¡ ---
                if (currentQuestionIndex > 0 && currentQuestionIndex <= totalPages) {
                    clearInterval(timerInterval);
                    const qIndex = currentQuestionIndex - 1;
                    const imgSrc = questions[qIndex].image;
                    
                    if (imgSrc) {
                        successImage.src = imgSrc;
                        successImage.style.display = "block";
                        document.getElementById('success-title').style.display = "block";
                    } else {
                        successImage.style.display = "none";
                        document.getElementById('success-title').innerText = "âœ… æ‹†å½ˆæˆåŠŸï¼";
                    }
                    successOverlay.style.display = 'flex';
                }
            } else if (e.code === 'KeyX') {
                if (currentQuestionIndex > 0 && currentQuestionIndex < totalPages) {
                    failOverlay.style.display = 'flex';
                    setTimeout(() => { failOverlay.style.display = 'none'; }, 1500);
                }
            }
        });

        // --- ç¨‹å¼ç¢¼è¼‰å…¥å¾Œç«‹åˆ»é¡¯ç¤ºé¦–é  ---
        showPage(-1);

    </script>
</body>
</html>

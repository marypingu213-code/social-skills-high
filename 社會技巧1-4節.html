<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾æœƒæŠ€å·§èª²ï¼šæµ£ç†Šçš„æˆ¿é–“</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹• */
        }
        .slide-wrapper {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e2e8f0;
            padding: 10px;
            box-sizing: border-box;
        }
        .slide-container {
            width: 100%;
            max-width: 1200px;
            height: 100%;
            max-height: 95vh; 
            aspect-ratio: 16/9;
            background: white;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .tablet-mode-container {
            width: 100vw;
            height: 100vh;
            background-color: #fce7f3; /* Pink-50 */
            overflow-y: auto;
        }
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Firebase Configuration Helper ---
        const getFirebaseConfig = () => {
            try {
                if (typeof __firebase_config !== 'undefined') {
                    return JSON.parse(__firebase_config);
                }
            } catch (e) {
                console.warn("No firebase config found");
            }
            return null;
        };

        const firebaseConfig = getFirebaseConfig();
        let db = null;
        let auth = null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'classroom-raccoon-001';
        
        if (firebaseConfig && firebase.apps.length === 0) {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
            } catch(e) {
                console.error("Firebase init error", e);
            }
        }

        // --- Constants ---
        const STUDENT_NAMES = ["ç‘€å®‰", "æ‰¿ç†™", "æ›¸æ„·", "å²·ç¿°", "ç¿ç©", "å®‡è»’", "æ¥·å…ƒ", "å®ˆæ©"];

        // æ¨¡æ“¬è³‡æ–™ (çµ¦å–®æ©Ÿæ¨¡å¼ç”¨)
        const MOCK_STUDENTS = STUDENT_NAMES.map((name, index) => ({
            id: `student-${index}`,
            name: name,
            order: index,
            checks: { eyes: false, hand: false, mouth: false },
            completed: false
        }));

        const App = () => {
            const [currentSlide, setCurrentSlide] = useState(0);
            const [lightStatus, setLightStatus] = useState('red');
            const [user, setUser] = useState(null);
            const [students, setStudents] = useState([]);
            const [isTabletMode, setIsTabletMode] = useState(false);
            const [selectedStudentId, setSelectedStudentId] = useState(null);
            const [isOfflineMode, setIsOfflineMode] = useState(!db); 
            const [isLocalFile, setIsLocalFile] = useState(false); // åµæ¸¬æ˜¯å¦ç‚º file:// å”è­°

            // æª¢æŸ¥ç’°å¢ƒ
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('mode') === 'student') {
                    setIsTabletMode(true);
                }
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºæœ¬æ©Ÿæª”æ¡ˆ
                if (window.location.protocol === 'file:') {
                    setIsLocalFile(true);
                    setIsOfflineMode(true); // æœ¬æ©Ÿæª”æ¡ˆä¸€å®šæ˜¯é›¢ç·šæ¨¡å¼ (é™¤éæ‰‹å‹•å¡«å…¥ config)
                }
            }, []);

            // --- Authentication & Data Sync ---
            useEffect(() => {
                if (!db) {
                    const savedData = localStorage.getItem('local_students_data');
                    if (savedData) {
                        setStudents(JSON.parse(savedData));
                    } else {
                        setStudents(MOCK_STUDENTS);
                    }
                    return;
                }

                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await auth.signInWithCustomToken(__initial_auth_token);
                    } else {
                        await auth.signInAnonymously();
                    }
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged(setUser);
                return () => unsubscribe();
            }, []);

            // --- Firestore Listener ---
            useEffect(() => {
                if (!user || !db) return;

                const studentsRef = db.collection('artifacts').doc(appId)
                                      .collection('public').doc('data')
                                      .collection('students_session_v1');
                
                const unsubscribe = studentsRef.onSnapshot((snapshot) => {
                    const loadedStudents = [];
                    snapshot.forEach(doc => {
                        loadedStudents.push({ id: doc.id, ...doc.data() });
                    });

                    loadedStudents.sort((a, b) => a.order - b.order);
                    
                    if (loadedStudents.length === 0) {
                        initializeStudents(studentsRef);
                    } else {
                        setStudents(loadedStudents);
                    }
                }, (error) => {
                    console.error("Error fetching students:", error);
                });

                return () => unsubscribe();
            }, [user]);

            const initializeStudents = async (collectionRef) => {
                const batch = db.batch();
                STUDENT_NAMES.forEach((name, index) => {
                    const docRef = collectionRef.doc(name);
                    batch.set(docRef, {
                        name: name,
                        order: index,
                        checks: { eyes: false, hand: false, mouth: false },
                        completed: false
                    });
                });
                await batch.commit();
            };

            const updateStudentCheck = async (studentId, checkItem, currentValue) => {
                if (db && user) {
                    const studentRef = db.collection('artifacts').doc(appId)
                                         .collection('public').doc('data')
                                         .collection('students_session_v1')
                                         .doc(studentId);
                    await studentRef.update({
                        [`checks.${checkItem}`]: !currentValue
                    });
                } else {
                    const newStudents = students.map(s => {
                        if (s.id === studentId) {
                            return {
                                ...s,
                                checks: { ...s.checks, [checkItem]: !currentValue }
                            };
                        }
                        return s;
                    });
                    setStudents(newStudents);
                    localStorage.setItem('local_students_data', JSON.stringify(newStudents));
                }
            };

            // ç›£è½ LocalStorage è®ŠåŒ–
            useEffect(() => {
                if (!db) {
                    const handleStorageChange = (e) => {
                        if (e.key === 'local_students_data' && e.newValue) {
                            setStudents(JSON.parse(e.newValue));
                        }
                    };
                    window.addEventListener('storage', handleStorageChange);
                    return () => window.removeEventListener('storage', handleStorageChange);
                }
            }, []);

            const calculateScore = (checks) => {
                return Object.values(checks || {}).filter(Boolean).length;
            };

            const totalSlides = 9;
            const nextSlide = () => { if (currentSlide < totalSlides - 1) setCurrentSlide(currentSlide + 1); };
            const prevSlide = () => { if (currentSlide > 0) setCurrentSlide(currentSlide - 1); };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (isTabletMode) return;
                    if (e.key === 'ArrowRight' || e.key === ' ') nextSlide();
                    if (e.key === 'ArrowLeft') prevSlide();
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [currentSlide, isTabletMode]);

            // --- Views ---
            if (isTabletMode) {
                if (selectedStudentId === null) {
                    return (
                        <div className="tablet-mode-container p-6">
                            {isOfflineMode && <div className="text-center bg-red-100 p-2 text-red-600 text-sm font-bold mb-2 rounded-lg">âš ï¸ å–®æ©Ÿæ¨¡å¼ï¼šè³‡æ–™ç„¡æ³•å‚³é€åˆ°é›»è¦–</div>}
                            <h1 className="text-4xl font-black text-pink-800 text-center mb-2 mt-4">æˆ‘æ˜¯èª°ï¼Ÿ</h1>
                            <p className="text-xl text-center text-gray-600 mb-8 font-bold">è«‹é»é¸ä½ çš„åå­—</p>
                            <div className="grid grid-cols-2 gap-6 max-w-4xl mx-auto">
                                {students.map(student => (
                                    <button
                                        key={student.id}
                                        onClick={() => setSelectedStudentId(student.id)}
                                        className="bg-white p-8 rounded-3xl shadow-lg border-b-8 border-pink-300 active:translate-y-2 active:border-b-0 transition-all"
                                    >
                                        <div className="text-4xl font-bold text-gray-800">{student.name}</div>
                                        {calculateScore(student.checks) === 3 && <div className="mt-2 text-2xl">ğŸ† å®Œæˆï¼</div>}
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                } else {
                    const currentStudent = students.find(s => s.id === selectedStudentId);
                    if (!currentStudent) return <div>è¼‰å…¥ä¸­...</div>;

                    return (
                        <div className="tablet-mode-container p-6 flex flex-col items-center">
                            <div className="w-full max-w-2xl flex justify-between items-center mb-8 mt-4">
                                <h2 className="text-4xl font-black text-pink-800">{currentStudent.name}çš„ä»»å‹™</h2>
                                <button 
                                    onClick={() => setSelectedStudentId(null)}
                                    className="bg-gray-200 text-gray-700 px-6 py-3 rounded-full font-bold text-xl shadow-md"
                                >
                                    è¿”å›
                                </button>
                            </div>

                            <div className="flex-1 w-full max-w-2xl space-y-6">
                                {[
                                    { key: 'eyes', icon: 'ğŸ‘€', text: 'æˆ‘æœ‰çœ‹ç´…ç¶ ç‡ˆ' },
                                    { key: 'hand', icon: 'âœ‹', text: 'æˆ‘æƒ³èªªè©±æœ‰èˆ‰æ‰‹' },
                                    { key: 'mouth', icon: 'ğŸ¤', text: 'åˆ¥äººèªªè©±æˆ‘å®‰éœ' }
                                ].map(item => (
                                    <div 
                                        key={item.key}
                                        onClick={() => updateStudentCheck(currentStudent.id, item.key, currentStudent.checks[item.key])}
                                        className={`flex items-center p-6 bg-white rounded-3xl shadow-lg cursor-pointer transition-all border-l-[16px] active:scale-95 ${currentStudent.checks[item.key] ? 'border-green-500 bg-green-50' : 'border-gray-300'}`}
                                    >
                                        <div className={`w-20 h-20 rounded-2xl border-4 mr-6 flex items-center justify-center transition-colors flex-shrink-0 ${currentStudent.checks[item.key] ? 'bg-green-500 border-green-500' : 'border-gray-300'}`}>
                                            {currentStudent.checks[item.key] && <span className="text-5xl text-white font-bold">âœ“</span>}
                                        </div>
                                        <span className="text-6xl mr-6">{item.icon}</span>
                                        <span className="text-4xl font-bold text-gray-700">{item.text}</span>
                                    </div>
                                ))}
                            </div>

                            {calculateScore(currentStudent.checks) === 3 && (
                                <div className="mt-8 mb-8 animate-bounce">
                                    <div className="bg-yellow-100 border-4 border-yellow-400 text-yellow-800 px-10 py-6 rounded-3xl shadow-xl text-center">
                                        <div className="text-6xl mb-2">ğŸŒŸ</div>
                                        <div className="text-3xl font-black">å¤ªæ£’äº†ï¼å…¨éƒ¨å®Œæˆï¼</div>
                                    </div>
                                </div>
                            )}
                        </div>
                    );
                }
            }

            const SlideContent = () => {
                switch(currentSlide) {
                    case 0: // Cover
                        return (
                            <div className="flex flex-col items-center justify-center h-full text-center space-y-4 bg-blue-50 p-4">
                                <div className="text-6xl animate-bounce-slow">ğŸ¦</div>
                                <h1 className="text-5xl font-black text-blue-800 tracking-wider">ç¤¾æœƒæŠ€å·§èª²</h1>
                                <div className="bg-white px-8 py-3 rounded-3xl border-4 border-blue-300 shadow-lg">
                                    <h2 className="text-3xl font-bold text-gray-700">æµ£ç†Šçš„æˆ¿é–“èˆ‡èªªè©±è¦å‰‡</h2>
                                </div>
                                <p className="text-lg text-gray-500 mt-2 font-bold">æº–å‚™å¥½ä½ çš„è€³æœµå’Œçœ¼ç›äº†å—ï¼Ÿ</p>
                            </div>
                        );
                    case 1: // Agenda
                        return (
                            <div className="flex flex-col h-full px-12 py-4 bg-yellow-50">
                                <h2 className="text-4xl font-bold text-yellow-800 mb-2 border-b-4 border-yellow-200 pb-2 w-fit mx-auto mt-2">ä»Šå¤©çš„ä»»å‹™</h2>
                                <div className="flex-1 flex flex-col justify-evenly max-w-3xl mx-auto w-full pb-4">
                                    <div className="flex items-center p-3 bg-white rounded-2xl shadow-md border-l-[10px] border-blue-500 hover:scale-105 transition-transform">
                                        <span className="text-4xl mr-6">ğŸ“–</span>
                                        <span className="text-3xl font-bold text-gray-700">1. è½ç¹ªæœ¬æ•…äº‹</span>
                                    </div>
                                    <div className="flex items-center p-3 bg-white rounded-2xl shadow-md border-l-[10px] border-green-500 hover:scale-105 transition-transform">
                                        <span className="text-4xl mr-6">ğŸ²</span>
                                        <span className="text-3xl font-bold text-gray-700">2. ç©ã€Œèªªè©±éŠæˆ²ã€</span>
                                    </div>
                                    <div className="flex items-center p-3 bg-white rounded-2xl shadow-md border-l-[10px] border-red-500 hover:scale-105 transition-transform">
                                        <span className="text-4xl mr-6">â­</span>
                                        <span className="text-3xl font-bold text-gray-700">3. é ˜å–çå‹µè²¼ç´™</span>
                                    </div>
                                </div>
                            </div>
                        );
                    case 2: // Traffic Light
                        return (
                            <div className="flex flex-col h-full px-8 py-4 bg-white">
                                <h2 className="text-4xl font-bold text-center text-gray-800 mb-4 mt-2">æ•™å®¤è£¡çš„ç´…ç¶ ç‡ˆ</h2>
                                <div className="flex justify-center items-center h-full gap-8 pb-4 flex-1">
                                    <div className={`flex flex-col items-center p-4 rounded-[2rem] transition-all duration-300 cursor-pointer ${lightStatus === 'red' ? 'bg-red-50 scale-105 border-4 border-red-400 shadow-xl' : 'opacity-40 grayscale hover:opacity-70'}`}
                                         onClick={() => setLightStatus('red')}>
                                        <div className="w-28 h-28 rounded-full bg-red-500 shadow-lg flex items-center justify-center mb-3 border-4 border-white ring-2 ring-red-200">
                                            <span className="text-5xl">ğŸ‘‚</span>
                                        </div>
                                        <h3 className="text-3xl font-black text-red-600 mb-1">ç´…ç‡ˆ</h3>
                                        <p className="text-lg font-bold text-gray-600 mb-1">è€³æœµæ‰“é–‹</p>
                                        <p className="text-lg font-bold text-gray-600">å˜´å·´æ‹‰æ‹‰éŠ</p>
                                    </div>
                                    <div className={`flex flex-col items-center p-4 rounded-[2rem] transition-all duration-300 cursor-pointer ${lightStatus === 'green' ? 'bg-green-50 scale-105 border-4 border-green-400 shadow-xl' : 'opacity-40 grayscale hover:opacity-70'}`}
                                         onClick={() => setLightStatus('green')}>
                                        <div className="w-28 h-28 rounded-full bg-green-500 shadow-lg flex items-center justify-center mb-3 border-4 border-white ring-2 ring-green-200">
                                            <span className="text-5xl">ğŸ—£ï¸</span>
                                        </div>
                                        <h3 className="text-3xl font-black text-green-600 mb-1">ç¶ ç‡ˆ</h3>
                                        <p className="text-lg font-bold text-gray-600 mb-1">ç¾åœ¨è¼ªåˆ°ä½ </p>
                                        <p className="text-lg font-bold text-gray-600">å¯ä»¥èªªè©±</p>
                                    </div>
                                </div>
                            </div>
                        );
                    case 3: // Story
                        return (
                            <div className="flex flex-col items-center h-full px-8 py-4 bg-indigo-50">
                                <h2 className="text-4xl font-bold text-indigo-900 mb-4 mt-2">ç¾åœ¨æ˜¯ä»€éº¼ç‡ˆï¼Ÿ</h2>
                                <div className="flex items-center justify-center space-x-12 w-full flex-1">
                                    <div className="bg-white p-4 rounded-3xl shadow-xl border-4 border-indigo-200 transform -rotate-2">
                                        <div className="relative">
                                            <img src="./æµ£ç†Šçš„æˆ¿é–“.jpg" alt="æµ£ç†Šçš„æˆ¿é–“" className="w-40 h-52 object-cover rounded-xl mb-3 shadow-inner bg-gray-100" onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }} />
                                            <div className="w-40 h-52 bg-gray-200 hidden flex-col items-center justify-center rounded-xl mb-3 text-gray-400 text-center p-2">
                                                <div className="text-center"><div className="text-4xl mb-2">ğŸ“š</div><div className="text-sm font-bold">åœ–ç‰‡è®€å–å¤±æ•—<br/>æµ£ç†Šçš„æˆ¿é–“.jpg</div></div>
                                            </div>
                                        </div>
                                        <p className="text-2xl text-center font-bold text-gray-700">è€å¸«åœ¨è¬›æ•…äº‹</p>
                                    </div>
                                    <div className="text-5xl font-bold text-indigo-300 animate-pulse">â¡ï¸</div>
                                    <div className="flex flex-col items-center animate-bounce-slow">
                                        <div className="w-32 h-32 rounded-full bg-red-500 shadow-2xl flex items-center justify-center border-[6px] border-white ring-4 ring-red-200"><span className="text-5xl">ğŸ¤«</span></div>
                                        <p className="text-2xl font-bold text-red-600 mt-4 bg-white px-6 py-2 rounded-full shadow-lg border-2 border-red-100">ç¾åœ¨æ˜¯ç´…ç‡ˆ</p>
                                    </div>
                                </div>
                            </div>
                        );
                    case 4: // Wait Card
                        return (
                            <div className="flex flex-col h-full px-8 py-4 bg-orange-50">
                                <h2 className="text-4xl font-bold text-orange-800 mb-2 mt-2 text-center">æˆ‘å¥½æƒ³èªªè©±ï¼Œæ€éº¼è¾¦ï¼Ÿ</h2>
                                <div className="flex-1 flex flex-col justify-center items-center">
                                    <div className="bg-white px-8 py-2 rounded-[2rem] shadow-xl border-4 border-orange-300 flex flex-col items-center cursor-pointer hover:scale-105 transition-transform mb-4">
                                        <span className="text-[4rem] mb-0 leading-none">âœ‹</span>
                                        <h3 className="text-2xl font-black text-orange-600">ç­‰å¾…å¡</h3>
                                    </div>
                                    <div className="w-full max-w-3xl space-y-2 pb-2">
                                        <div className="flex items-center text-xl font-bold text-gray-700 bg-white/50 p-2 rounded-xl"><span className="bg-orange-500 text-white w-8 h-8 text-lg rounded-full flex items-center justify-center mr-4 shadow-md font-black flex-shrink-0">1</span>æŠŠã€Œç­‰å¾…å¡ã€èˆ‰é«˜é«˜</div>
                                        <div className="flex items-center text-xl font-bold text-gray-700 bg-white/50 p-2 rounded-xl"><span className="bg-orange-500 text-white w-8 h-8 text-lg rounded-full flex items-center justify-center mr-4 shadow-md font-black flex-shrink-0">2</span>å˜´å·´é–‰é–‰ï¼Œçœ¼ç›çœ‹è€å¸«</div>
                                        <div className="flex items-center text-xl font-bold text-gray-700 bg-white/50 p-2 rounded-xl"><span className="bg-orange-500 text-white w-8 h-8 text-lg rounded-full flex items-center justify-center mr-4 shadow-md font-black flex-shrink-0">3</span>è€å¸«é»é ­ï¼Œè®Šç¶ ç‡ˆå†èªªè©±</div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 5: // Rabbits
                        return (
                            <div className="flex flex-col h-full px-8 py-4 bg-white">
                                <h2 className="text-4xl font-bold text-center text-purple-800 mb-2 mt-2">å¹«å¹«å°å…”å­ï¼</h2>
                                <div className="flex-1 flex items-center justify-center space-x-8">
                                    <div className="relative group">
                                        <span className="text-[5rem] block transform group-hover:-translate-y-4 transition-transform duration-300">ğŸ°</span>
                                        <div className="absolute -top-10 -right-16 bg-white border-4 border-gray-800 rounded-2xl p-2 shadow-xl w-40 z-10 bubble-bottom-left"><p className="text-sm font-bold leading-tight">æˆ‘å‘Šè¨´ä½ å–”ï¼é‚£å€‹æµ£ç†Šå¾Œä¾†å°±...</p></div>
                                        <p className="text-center text-base font-bold mt-1 bg-purple-100 py-1 px-4 rounded-full text-purple-800">é˜¿ç™½ (ä¸€ç›´èªª)</p>
                                    </div>
                                    <div className="relative opacity-60">
                                        <span className="text-[5rem] block transform scale-x-[-1]">ğŸ°</span>
                                        <div className="absolute -top-4 -left-8 animate-pulse"><span className="text-3xl">ğŸ˜–</span></div>
                                        <p className="text-center text-base font-bold mt-1 bg-gray-200 py-1 px-4 rounded-full text-gray-600">åœŸåœŸ (æƒ³å®‰éœ)</p>
                                    </div>
                                </div>
                                <div className="bg-purple-100 p-2 rounded-2xl text-center mt-2 max-w-xl mx-auto border-4 border-purple-200 mb-2">
                                    <p className="text-xl font-bold text-purple-900 mb-1">é˜¿ç™½å¿˜è¨˜çœ‹ç´…ç¶ ç‡ˆäº†ï¼</p>
                                    <p className="text-lg text-purple-700 font-bold">èª°å¯ä»¥æ‹¿ã€Œç­‰å¾…å¡ã€æ•™æ•™ä»–ï¼Ÿ</p>
                                </div>
                            </div>
                        );
                    case 6: // Microphone
                        return (
                            <div className="flex flex-col items-center h-full px-8 py-4 bg-cyan-50">
                                <h2 className="text-4xl font-bold text-cyan-800 mb-2 mt-2">é€™æ˜¯èª°çš„ç™¼è¨€æ™‚é–“ï¼Ÿ</h2>
                                <div className="flex-1 flex flex-col justify-center items-center w-full">
                                    <div className="bg-gradient-to-br from-gray-700 to-gray-900 p-4 rounded-full shadow-2xl mb-4 border-[6px] border-gray-300 transform hover:scale-110 transition-transform duration-500"><span className="text-[3rem] text-white">ğŸ¤</span></div>
                                    <div className="bg-white p-3 rounded-2xl shadow-xl border-l-[10px] border-cyan-500 max-w-xl w-full">
                                        <div className="grid grid-cols-2 gap-3 text-center">
                                            <div className="p-2 bg-green-50 rounded-xl"><p className="text-base text-gray-500 mb-1">æœ‰æ‹¿ <span className="text-cyan-600 font-bold">éº¥å…‹é¢¨</span></p><p className="text-2xl font-black text-green-600">= ç¶ ç‡ˆ ğŸŸ¢</p></div>
                                            <div className="p-2 bg-red-50 rounded-xl"><p className="text-base text-gray-500 mb-1">æ²’æœ‰æ‹¿çš„äºº</p><p className="text-2xl font-black text-red-600">= ç´…ç‡ˆ ğŸ”´</p></div>
                                        </div>
                                    </div>
                                    <p className="mt-4 text-lg text-gray-600 font-bold bg-white/80 px-6 py-2 rounded-full border-2 border-cyan-200 shadow-sm mb-2">å¦‚æœä½ æƒ³æ‹¿éº¥å…‹é¢¨ï¼Œè¦å…ˆåšä»€éº¼ï¼Ÿ</p>
                                </div>
                            </div>
                        );
                    case 7: // TV Mode: Class Dashboard
                        const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(window.location.href + '?mode=student')}`;
                        
                        return (
                            <div className="flex flex-col h-full px-6 py-4 bg-pink-50 relative">
                                <h2 className="text-4xl font-bold text-pink-800 mb-4 mt-2 text-center">å…¨ç­æŒ‘æˆ°è³½</h2>
                                {isOfflineMode && <div className="absolute top-4 left-4 text-red-500 text-xs font-bold bg-white p-1 rounded">âš ï¸ å–®æ©Ÿç‰ˆ (ç„¡é€£ç·š)</div>}
                                
                                {/* ç©åˆ†æ¿å€åŸŸ */}
                                <div className="flex-1 w-full grid grid-cols-4 gap-4 align-content-start overflow-y-auto">
                                    {students.map(student => (
                                        <div 
                                            key={student.id}
                                            className={`p-3 rounded-2xl shadow-md border-b-4 transition-all flex flex-col items-center justify-center ${calculateScore(student.checks) === 3 ? 'bg-yellow-100 border-yellow-400 scale-105' : 'bg-white border-pink-200'}`}
                                        >
                                            <div className="text-3xl mb-1">
                                                {calculateScore(student.checks) === 3 ? 'ğŸ†' : 'ğŸ™‚'}
                                            </div>
                                            <h3 className="text-xl font-bold text-gray-800 mb-1">{student.name}</h3>
                                            <div className="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 mt-1">
                                                <div className="bg-pink-500 h-2.5 rounded-full transition-all duration-500" style={{width: `${(calculateScore(student.checks)/3)*100}%`}}></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* QR Code å€åŸŸ (å³ä¸‹è§’) */}
                                {isLocalFile ? (
                                    <div className="absolute bottom-4 right-4 bg-white p-4 rounded-xl shadow-lg border-4 border-red-200 flex flex-col items-center max-w-sm">
                                        <p className="font-bold text-red-600 text-lg mb-1">âš ï¸ ç„¡æ³•ä½¿ç”¨ QR Code</p>
                                        <p className="text-sm text-gray-600 text-center">
                                            ç›®å‰ç‚ºæœ¬æ©Ÿæª”æ¡ˆ (file://)ï¼Œ<br/>æ‰‹æ©Ÿç„¡æ³•æƒæé€£ç·šã€‚<br/>è«‹å°‡æª”æ¡ˆä¸Šå‚³è‡³ç¶²è·¯ç©ºé–“ã€‚
                                        </p>
                                    </div>
                                ) : (
                                    <div className="absolute bottom-4 right-4 bg-white p-4 rounded-xl shadow-lg flex items-center gap-4 border-4 border-pink-200">
                                        <img src={qrCodeUrl} alt="Scan for Student Mode" className="w-40 h-40" />
                                        <div className="text-left">
                                            <p className="font-bold text-gray-700 text-2xl">æƒæåŠ å…¥</p>
                                            <p className="text-base text-gray-500">å¹³æ¿æ¨¡å¼</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        );
                    case 8: // Final Reward
                        return (
                            <div className="flex flex-col items-center justify-center h-full text-center space-y-4 bg-yellow-100">
                                <div className="text-[6rem] animate-pulse drop-shadow-2xl">ğŸŒŸ</div>
                                <h2 className="text-6xl font-black text-yellow-600 tracking-wider">ä»»å‹™æˆåŠŸï¼</h2>
                                <p className="text-3xl font-bold text-gray-700 bg-white/60 px-8 py-3 rounded-full">ä½ å¯ä»¥å»é ˜çå‹µè²¼ç´™å›‰ï¼</p>
                                <div className="flex gap-4 mt-4">
                                    <span className="text-6xl animate-bounce" style={{animationDelay: '0s'}}>ğŸ¦</span>
                                    <span className="text-6xl animate-bounce" style={{animationDelay: '0.2s'}}>ğŸ°</span>
                                    <span className="text-6xl animate-bounce" style={{animationDelay: '0.4s'}}>ğŸ¦Š</span>
                                </div>
                            </div>
                        );
                    default:
                        return <div>Slide Error</div>;
                }
            };

            return (
                <div className="slide-wrapper">
                    <div className="slide-container">
                        <SlideContent />
                        
                        {!isTabletMode && (
                            <>
                                <button onClick={prevSlide} disabled={currentSlide === 0} className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/50 hover:bg-white text-gray-800 p-4 rounded-full shadow-lg disabled:opacity-0 transition-all backdrop-blur-sm z-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M15 19l-7-7 7-7" /></svg>
                                </button>
                                <button onClick={nextSlide} disabled={currentSlide === totalSlides - 1} className="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/50 hover:bg-white text-gray-800 p-4 rounded-full shadow-lg disabled:opacity-0 transition-all backdrop-blur-sm z-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M9 5l7 7-7 7" /></svg>
                                </button>
                                <div className="absolute bottom-4 right-6 bg-black/10 px-4 py-1 rounded-full text-gray-600 font-bold text-lg backdrop-blur-sm">
                                    {currentSlide + 1} / {totalSlides}
                                </div>
                            </>
                        )}
                        
                        {!isTabletMode && currentSlide === 7 && isLocalFile && (
                            <button onClick={() => window.open(window.location.href + '?mode=student', '_blank')} className="absolute bottom-4 left-4 bg-pink-600 text-white font-bold p-3 rounded-lg shadow-lg hover:bg-pink-700 z-50">
                                é–‹å•Ÿå­¸ç”Ÿå¹³æ¿è¦–çª— (æ¸¬è©¦ç”¨)
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>